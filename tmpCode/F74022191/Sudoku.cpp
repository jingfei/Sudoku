#include<iostream>
#include<cstring>
#include<cstdlib>
#include<ctime>
#include"Sudoku.h"
using namespace std;

void Sudoku::GiveQuestion(){
  srand(time(NULL));
  int v=rand()%32;
  int i, j;
  for (i=0 ; i<Size ; i++){
    for (j=0 ; j<Size ; j++){
      cout << question[v][i*9+j] << " ";
    }
    cout << endl;
  }
}
void Sudoku::ReadIn(){
  int i, j;
  Sn=0;
  for (i=0 ; i<Size ; i++){
    for (j=0 ; j<=9 ; j++){
      row[i][j]=0;
      column[i][j]=0;
      box[i][j]=0;
    }
  } 
  for (i=0 ; i<Size ; i++){
    for (j=0 ; j<Size ; j++){
      cin >> map[i][j];
      if (map[i][j]==0){
	S[Sn].r=i;
	S[Sn].c=j;
	S[Sn].b=findbox(i, j);
	S[Sn].value=0;
	Sn++;
      } else {
	row[i][map[i][j]]=1;
	column[j][map[i][j]]=1;
	box[findbox(i, j)][map[i][j]]=1;
      }
    }
  }
/*
  print();
  cout << "row: " << endl;
  for (i=0 ; i<Size ; i++){
    for (j=1 ; j<=9 ; j++){
      cout << row[i][j] << " ";
    }
    cout << endl;
  }
  cout << "column: " << endl;
  for (i=0 ; i<Size ; i++){
    for (j=1 ; j<=9 ; j++){
      cout << column[i][j] << " ";
    }
    cout << endl;
  }
  cout << "box: " << endl;
  for (i=0 ; i<Size ; i++){
    for (j=1 ; j<=9 ; j++){
      cout << box[i][j] << " ";
    }
    cout << endl;
  }
  cout << "Sn=" << Sn << endl;
  cout << "row\tcolumn\tbox\t" << endl;
  int a;
  for (a=0 ; a<Sn ; a++){
    cout << S[a].r << "\t" << S[a].c << "\t" << S[a].b << endl;
  }
*/
}
void Sudoku::print(){
  int i, j;
  for (i=0 ; i<Size ; i++){
    for (j=0 ; j<Size ; j++){
      cout << map[i][j] << " ";
    }
    cout << endl;
  }
}
void Sudoku::Solve(){
  int n=0, used_n=1, solution=0;
  while (1){
    //cout << "n= " << n << " " << used_n << endl ; 
    if (n<0){
      if (solution==0){
	//no answer
	cout << "0" << endl;
	return ;
      } else if (solution==1){
	//one answer
	cout << "1" << endl;
	print();
	return ;
      } else {
	//mutiple answer
	cout << "2" << endl;
	return ;
      }
    }
    if (n>=Sn){
      //find one answer
      //check if there are another answers or not
      solution++;
      //print();
      n=Sn-1;
      row[S[n].r][S[n].value]=0;
      column[S[n].c][S[n].value]=0;
      box[S[n].b][S[n].value]=0;
      used_n=S[n].value+1;
    }
    int i=S[n].r, j=S[n].c, bn=S[n].b;
    //cout << row[i][used_n] << column[j][used_n] << box[bn][used_n] << endl;
    for (; used_n<=9 ; used_n++){
      if (row[i][used_n]==0 && column[j][used_n]==0 && box[bn][used_n]==0)
	break;
    }
    if (used_n<=9){
      map[i][j]=used_n;
      S[n].value=used_n;
      row[i][used_n]=1;
      column[j][used_n]=1;
      box[bn][used_n]=1;
      n++;
      used_n=1;
    } else {
      n--;
      if (n<0) continue;
      int v=S[n].value;
      row[S[n].r][v]=0;
      column[S[n].c][v]=0;
      box[S[n].b][v]=0;
      used_n=v+1;
    }
  }
}
int Sudoku::findbox(int i, int j){
  if (i<3){
    if (j<3)
      return 0;
    else if (j<6&&j>=3)
      return 1;
    else if (j>=6)
      return 2;
  } else if (i>=3&&i<6){
    if (j<3)
      return 3;
    else if (j<6&&j>=3)
      return 4; 
    else if (j>=6)
      return 5;
  } else if (i>=6){
    if (j<3)
      return 6;
    else if (j<6&&j>=3)
      return 7;
    else if (j>=6)
      return 8;
  }
}
Sudoku::Sudoku(){
  int a[32*81]={3, 6, 0, 2, 0, 0, 0, 4, 5,
		0, 0, 0, 5, 3, 0, 6, 9, 0,
		0, 8, 7, 0, 0, 0, 1, 0, 0,
		0, 0, 0, 1, 2, 0, 9, 6, 0,
		0, 0, 3, 6, 0, 5, 8, 0, 0,
		0, 2, 8, 0, 9, 4, 0, 0, 0,
		0, 0, 1, 0, 0, 0, 4, 8, 0,
		0, 7, 5, 0, 6, 3, 0, 0, 0,
		2, 4, 0, 0, 0, 9, 0, 5, 7,
		0, 3, 1, 7, 0, 4, 0, 0, 0,
		0, 0, 4, 0, 1, 0, 8, 0, 7,
		0, 6, 0, 5, 0, 0, 0, 1, 9,
		2, 0, 0, 0, 6, 0, 3, 0, 5,
		0, 9, 0, 1, 0, 2, 0, 6, 0,
		3, 0, 6, 0, 5, 0, 0, 0, 4,
		5, 4, 0, 0, 0, 1, 0, 8, 0,
		6, 0, 3, 0, 2, 0, 9, 0, 0,
		0, 0, 0, 3, 0, 9, 5, 7, 0,
		5, 0, 0, 2, 1, 0, 0, 3, 0,
		2, 6, 0, 0, 0, 7, 0, 4, 1,
		9, 0, 0, 0, 5, 0, 0, 0, 6,
		0, 0, 4, 3, 0, 5, 0, 1, 0,
		0, 7, 2, 4, 0, 0, 6, 8, 0,
		0, 9, 0, 0, 6, 0, 3, 0, 0,
		4, 0, 0, 0, 8, 0, 0, 0, 2,
		7, 3, 0, 6, 0, 0, 0, 5, 8,
		0, 2, 0, 0, 7, 9, 0, 0, 3,
		0, 0, 0, 2, 0, 0, 0, 3, 1,
		1, 0, 0, 0, 3, 4, 0, 5, 0,
		2, 3, 0, 7, 0, 0, 0, 0, 0,
		0, 4, 0, 0, 0, 7, 0, 0, 9,
		5, 0, 0, 0, 0, 0, 0, 0, 3,
		8, 0, 0, 5, 0, 0, 0, 2, 0,
		0, 0, 0, 0, 0, 2, 0, 4, 6,
		0, 8, 0, 4, 7, 0, 0, 0, 2,
		4, 6, 0, 0, 0, 8, 0, 0, 0,
		0, 0, 8, 0, 0, 0, 0, 0, 0,
		6, 0, 0, 4, 0, 2, 0, 5, 0,
		0, 5, 0, 9, 0, 7, 0, 0, 0,
		0, 8, 9, 0, 0, 0, 3, 0, 0,
		3, 0, 1, 0, 0, 0, 6, 0, 7,
		0, 0, 6, 0, 0, 0, 9, 4, 0,
		0, 0, 0, 2, 0, 6, 0, 3, 0,
		0, 3, 0, 7, 0, 4, 0, 0, 9,
		0, 0, 0, 0, 0, 0, 4, 0, 0,
		0, 8, 0, 0, 5, 0, 0, 6, 0,
		0, 0, 0, 0, 3, 0, 0, 1, 8,
		0, 0, 1, 0, 0, 9, 0, 0, 4,
		7, 0, 0, 0, 0, 5, 0, 0, 0,
		2, 0, 0, 6, 8, 3, 0, 0, 7,
		0, 0, 0, 9, 0, 0, 0, 0, 5,
		8, 0, 0, 7, 0, 0, 2, 0, 0,
		3, 2, 0, 0, 9, 0, 0, 0, 0,
		0, 7, 0, 0, 2, 0, 0, 8, 0,
		0, 9, 0, 0, 2, 0, 0, 0, 6,
		0, 0, 3, 0, 6, 0, 8, 0, 0,
		6, 0, 0, 0, 0, 3, 9, 0, 0,
		5, 0, 0, 0, 0, 6, 0, 0, 1,
		4, 8, 0, 7, 0, 0, 0, 9, 3,
		7, 0, 0, 0, 1, 9, 0, 0, 8,
		0, 0, 8, 2, 0, 0, 0, 0, 9,
		0, 0, 6, 0, 3, 0, 4, 0, 0,
		2, 0, 0, 0, 9, 0, 0, 5, 0,
		4, 0, 0, 1, 0, 0, 0, 0, 5,
		0, 0, 9, 2, 0, 7, 0, 0, 3,
		0, 0, 0, 0, 3, 0, 0, 2, 0,
		0, 0, 0, 0, 0, 0, 4, 1, 2,
		0, 0, 3, 0, 8, 0, 6, 0, 0,
		1, 5, 4, 0, 0, 0, 0, 0, 0,
		0, 2, 0, 0, 4, 0, 0, 0, 0,
		7, 0, 0, 8, 0, 9, 1, 0, 0,
		9, 0, 0, 0, 0, 3, 0, 0, 6,
		2, 0, 1, 0, 0, 5, 4, 0, 0,
		5, 7, 0, 2, 0, 0, 0, 0, 6,
		0, 6, 0, 0, 0, 0, 0, 0, 0,
		0, 9, 5, 0, 0, 0, 0, 0, 0,
		0, 0, 2, 8, 0, 3, 6, 0, 0,
		0, 0, 0, 0, 0, 0, 1, 3, 0,
		0, 0, 0, 0, 0, 0, 0, 6, 0,
		6, 0, 0, 0, 0, 2, 0, 9, 5,
		0, 0, 7, 9, 0, 0, 2, 0, 1,
		0, 0, 0, 0, 9, 0, 2, 4, 0,
		0, 0, 0, 0, 3, 5, 0, 9, 0,
		0, 6, 4, 0, 0, 7, 0, 0, 0,
		6, 0, 0, 0, 0, 0, 0, 0, 3,
		0, 0, 1, 0, 4, 0, 9, 0, 0,
		7, 0, 0, 0, 0, 0, 0, 0, 1,
		0, 0, 0, 9, 0, 0, 1, 5, 0,
		0, 5, 0, 2, 1, 0, 0, 0, 0,
		0, 3, 9, 0, 6, 0, 0, 0, 0,
		0, 0, 1, 6, 0, 0, 0, 7, 0,
		6, 0, 0, 0, 0, 5, 0, 0, 0,
		3, 0, 7, 2, 0, 0, 0, 0, 4,
		0, 0, 2, 4, 0, 0, 0, 0, 0,
		0, 0, 0, 9, 1, 6, 0, 0, 0,
		0, 0, 0, 0, 0, 7, 3, 0, 0,
		9, 0, 0, 0, 0, 2, 8, 0, 3,
		0, 0, 0, 3, 0, 0, 0, 0, 7,
		0, 6, 0, 0, 0, 1, 5, 0, 0,
		0, 0, 0, 0, 0, 2, 4, 0, 0,
		0, 0, 0, 4, 0, 0, 0, 0, 8,
		7, 0, 0, 9, 3, 0, 0, 0, 0,
		0, 0, 7, 0, 0, 5, 8, 3, 0,
		0, 0, 1, 0, 4, 0, 9, 0, 0,
		0, 9, 2, 7, 0, 0, 5, 0, 0,
		0, 0, 0, 0, 6, 4, 0, 0, 3,
		2, 0, 0, 0, 0, 1, 0, 0, 0,
		0, 0, 4, 5, 0, 0, 0, 0, 0,
		0, 1, 0, 2, 0, 0, 0, 0, 5,
		0, 0, 3, 0, 0, 5, 0, 9, 2,
		0, 0, 0, 0, 0, 0, 7, 3, 0,
		0, 0, 0, 3, 0, 6, 8, 4, 0,
		0, 0, 0, 0, 4, 0, 0, 0, 0,
		0, 4, 7, 5, 0, 8, 0, 0, 0,
		0, 8, 1, 0, 0, 0, 0, 0, 0,
		2, 7, 0, 4, 0, 0, 1, 0, 0,
		4, 0, 0, 0, 0, 3, 0, 2, 0,
		9, 3, 1, 0, 0, 0, 5, 0, 0,
		0, 0, 0, 0, 5, 0, 0, 4, 0,
		0, 0, 0, 3, 0, 9, 0, 1, 8,
		1, 4, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 9, 0, 8, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 5, 3,
		5, 7, 0, 1, 0, 6, 0, 0, 0,
		0, 8, 0, 0, 7, 0, 0, 0, 0,
		0, 0, 4, 0, 0, 0, 7, 8, 2,
		0, 0, 5, 6, 0, 0, 4, 1, 0,
		0, 9, 6, 2, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 5, 0,
		2, 0, 8, 0, 4, 0, 0, 0, 0,
		4, 0, 0, 0, 6, 0, 0, 0, 1,
		0, 0, 0, 0, 7, 0, 3, 0, 2,
		0, 8, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 7, 1, 6, 0,
		0, 7, 1, 0, 0, 3, 9, 0, 0,
		7, 0, 0, 9, 0, 0, 5, 1, 0,
		0, 0, 0, 0, 6, 0, 8, 0, 0,
		0, 0, 1, 2, 0, 0, 0, 0, 0,
		0, 0, 0, 6, 0, 0, 0, 4, 8,
		0, 0, 8, 0, 1, 0, 6, 0, 0,
		6, 9, 0, 0, 0, 3, 0, 0, 0,
		0, 0, 0, 0, 0, 2, 3, 0, 0,
		0, 0, 9, 0, 4, 0, 0, 0, 0,
		0, 5, 3, 0, 0, 8, 0, 0, 7,
		0, 0, 0, 0, 0, 0, 0, 8, 0,
		0, 0, 3, 1, 0, 0, 7, 0, 4,
		1, 8, 0, 0, 3, 7, 0, 0, 0,
		0, 7, 0, 0, 0, 8, 0, 0, 5,
		0, 9, 0, 0, 0, 0, 0, 3, 0,
		3, 0, 0, 6, 0, 0, 0, 2, 0,
		0, 0, 0, 2, 1, 0, 0, 9, 6,
		4, 0, 1, 0, 0, 5, 8, 0, 0,
		0, 2, 0, 0, 0, 0, 0, 0, 0,
		1, 0, 0, 2, 5, 0, 0, 0, 0,
		3, 4, 0, 0, 0, 9, 0, 0, 0,
		0, 9, 0, 4, 0, 0, 0, 0, 5,
		0, 8, 0, 5, 0, 0, 6, 0, 0,
		0, 0, 0, 0, 3, 0, 0, 0, 0,
		0, 0, 7, 0, 0, 1, 0, 4, 0,
		9, 0, 0, 0, 0, 8, 0, 7, 0,
		0, 0, 0, 3, 0, 0, 0, 1, 4,
		0, 0, 0, 0, 6, 5, 0, 0, 9,
		0, 0, 4, 0, 0, 0, 8, 0, 6,
		0, 0, 0, 0, 0, 0, 0, 5, 0,
		7, 1, 0, 6, 0, 3, 0, 0, 0,
		0, 0, 5, 2, 4, 0, 0, 0, 0,
		0, 2, 0, 0, 3, 0, 0, 9, 0,
		0, 0, 0, 0, 7, 8, 2, 0, 0,
		0, 0, 0, 4, 0, 2, 0, 3, 8,
		0, 9, 0, 0, 0, 0, 0, 0, 0,
		3, 0, 2, 0, 0, 0, 1, 0, 0,
		0, 6, 0, 1, 0, 4, 0, 5, 0,
		0, 0, 8, 3, 0, 5, 6, 0, 0,
		2, 0, 0, 0, 0, 0, 0, 0, 1,
		8, 0, 0, 4, 0, 7, 0, 0, 6,
		0, 0, 6, 0, 0, 0, 3, 0, 0,
		7, 0, 0, 9, 0, 1, 0, 0, 4,
		5, 0, 0, 0, 0, 0, 0, 0, 2,
		0, 0, 7, 2, 0, 6, 9, 0, 0,
		0, 4, 0, 5, 0, 8, 0, 7, 0,
		0, 6, 0, 0, 3, 0, 0, 1, 0,
		0, 0, 3, 2, 0, 9, 4, 0, 0,
		1, 0, 0, 0, 0, 0, 0, 0, 9,
		0, 0, 0, 0, 7, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 1, 0, 4, 9, 8, 0, 2, 0,
		3, 0, 1, 5, 8, 2, 7, 0, 6,
		0, 2, 0, 3, 0, 1, 0, 8, 0,
		0, 0, 6, 0, 0, 0, 2, 0, 0,
		0, 0, 8, 0, 9, 0, 3, 0, 0,
		0, 1, 0, 0, 3, 0, 0, 2, 0,
		4, 0, 0, 0, 0, 0, 0, 0, 8,
		0, 3, 0, 0, 0, 0, 0, 8, 0,
		0, 0, 1, 7, 5, 9, 6, 0, 0,
		9, 0, 0, 0, 0, 0, 0, 0, 1,
		0, 0, 0, 5, 7, 4, 0, 0, 0,
		1, 0, 4, 9, 0, 3, 8, 0, 5,
		3, 0, 0, 0, 0, 0, 0, 0, 6,
		0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 4, 2, 0, 0, 0, 9, 1, 0,
		6, 1, 0, 0, 0, 0, 0, 4, 8,
		0, 0, 0, 0, 8, 0, 0, 0, 0,
		8, 0, 0, 3, 0, 4, 0, 0, 5,
		0, 0, 0, 7, 0, 2, 0, 0, 0,
		0, 9, 6, 5, 0, 8, 7, 2, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 5, 4, 9, 7, 6, 3, 8, 0,
		0, 1, 6, 0, 0, 0, 4, 7, 0,
		4, 3, 0, 0, 7, 0, 0, 6, 5,
		0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 3, 0, 6, 0, 1, 0, 0,
		0, 0, 0, 5, 8, 9, 0, 0, 0,
		5, 0, 9, 2, 0, 3, 6, 0, 4,
		0, 6, 0, 1, 0, 7, 0, 9, 0,
		0, 0, 0, 0, 3, 0, 0, 0, 0,
		1, 0, 0, 8, 0, 2, 0, 0, 6,
		0, 4, 5, 8, 0, 9, 6, 1, 0,
		0, 0, 3, 0, 1, 0, 8, 0, 0,
		8, 0, 0, 0, 2, 0, 0, 0, 5,
		6, 0, 0, 0, 8, 0, 0, 0, 3,
		0, 0, 0, 9, 0, 6, 0, 0, 0,
		0, 0, 0, 0, 5, 0, 0, 0, 0,
		5, 0, 0, 4, 7, 2, 0, 0, 8,
		0, 8, 0, 0, 0, 0, 0, 5, 0,
		0, 7, 2, 0, 0, 0, 1, 4, 0,
		0, 0, 3, 0, 7, 0, 2, 0, 0,
		0, 9, 0, 0, 0, 0, 0, 1, 0,
		0, 0, 0, 9, 0, 6, 0, 0, 0,
		0, 0, 4, 0, 9, 0, 6, 0, 0,
		0, 6, 0, 0, 3, 0, 0, 2, 0,
		0, 8, 9, 0, 0, 0, 1, 5, 0,
		0, 0, 0, 0, 4, 0, 0, 0, 0,
		0, 0, 8, 3, 0, 5, 4, 0, 0,
		0, 5, 0, 2, 0, 7, 0, 9, 0,
		0, 6, 9, 0, 0, 0, 2, 4, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 4, 9, 5, 7, 6, 0, 0,
		0, 8, 0, 7, 0, 4, 0, 9, 0,
		9, 0, 0, 0, 0, 0, 0, 0, 2,
		0, 0, 6, 0, 0, 0, 4, 0, 0,
		0, 9, 0, 3, 0, 8, 0, 2, 0,
		0, 0, 8, 1, 0, 2, 9, 0, 0,
		0, 0, 7, 4, 0, 5, 1, 0, 0,
		7, 9, 0, 0, 0, 0, 0, 6, 3,
		0, 2, 0, 0, 4, 0, 0, 5, 0,
		0, 6, 4, 0, 7, 0, 2, 1, 0,
		0, 0, 0, 0, 3, 0, 0, 0, 0,
		0, 0, 2, 9, 1, 7, 5, 0, 0,
		0, 7, 0, 0, 0, 0, 0, 9, 0,
		0, 0, 7, 0, 5, 0, 9, 0, 0,
		0, 0, 0, 1, 0, 8, 0, 0, 0,
		6, 4, 0, 0, 0, 0, 0, 8, 5,
		2, 0, 7, 0, 5, 0, 4, 0, 9,
		1, 0, 0, 7, 0, 6, 0, 0, 8,
		0, 0, 0, 0, 0, 0, 0, 0, 0,
		4, 0, 1, 6, 0, 5, 2, 0, 7,
		0, 0, 0, 0, 9, 0, 0, 0, 0,
		0, 0, 0, 2, 0, 7, 0, 0, 0,
		0, 4, 5, 8, 0, 9, 7, 3, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0,
		7, 0, 9, 4, 0, 3, 8, 0, 5,
		0, 2, 4, 0, 0, 0, 3, 5, 0,
		0, 0, 0, 7, 0, 4, 0, 0, 0,
		1, 0, 0, 0, 5, 0, 0, 0, 6,
		4, 0, 0, 1, 0, 5, 0, 0, 2,
		3, 0, 0, 0, 0, 0, 0, 0, 8,
		0, 7, 0, 0, 3, 0, 0, 9, 0,
		0, 0, 0, 5, 0, 1, 0, 0, 0,
		0, 6, 0, 0, 2, 0, 0, 1, 0,
		0, 4, 0, 8, 0, 3, 0, 7, 0,
		0, 6, 0, 0, 0, 0, 0, 8, 0,
		8, 0, 4, 0, 9, 0, 7, 0, 2,
		0, 0, 0, 8, 0, 7, 0, 0, 0,
		9, 0, 7, 0, 8, 0, 3, 0, 5,
		0, 0, 2, 0, 0, 0, 6, 0, 0,
		0, 3, 0, 0, 4, 0, 0, 2, 0,
		0, 7, 0, 9, 0, 5, 0, 3, 0,
		4, 0, 0, 0, 1, 0, 0, 0, 9,
		0, 9, 0, 0, 0, 0, 0, 5, 0,
		0, 0, 2, 0, 7, 0, 6, 0, 0,
		0, 0, 0, 8, 4, 2, 0, 0, 0,
		4, 0, 0, 3, 0, 6, 0, 0, 5,
		0, 0, 4, 0, 6, 0, 3, 0, 0,
		9, 0, 0, 0, 0, 0, 0, 0, 7,
		0, 0, 0, 1, 2, 9, 0, 0, 0,
		0, 2, 0, 0, 0, 0, 0, 3, 0,
		0, 0, 6, 0, 0, 0, 4, 0, 0,
		0, 0, 0, 9, 1, 5, 0, 0, 0};
  memcpy(question, a, 32*81*sizeof(int));
}
